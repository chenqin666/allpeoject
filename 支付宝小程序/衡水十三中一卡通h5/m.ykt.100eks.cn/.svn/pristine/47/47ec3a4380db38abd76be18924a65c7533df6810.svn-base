<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="content-type" content="text/html;charset=gbk">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <title></title>
    <link href="css/reset.css" rel="stylesheet">
    <link href="css/index.css" rel="stylesheet">
    <script type="text/javascript">
        var w = document.documentElement.clientWidth>=1024?1024:document.documentElement.clientWidth;
        document.documentElement.style.fontSize = w / 750*100 + 'px';
    </script>
    <style>
        .icon{
            width: 0.5rem;
        }

        .arrow{
            width: 0.32rem;
            margin-left: 0.1rem;
        }

        .nothing{
            display: block;
            margin: 0 auto;
            width: 3rem;
            margin-top: 3rem;
            padding-bottom: 3rem;
        }

        [v-cloak] {
            display: none;
        }

    </style>
    
</head>
<body>

<div class="warp" id="warp"  v-cloak>
    {{redirect_uri}}
    <!--微信打开-->
    <!-- <div v-if="isalipay&&isalipay==1" class="broswer_alert_box">

        <img src="img/icon_unsupport.png" class="broswer_alert_img">
        <div class="broswer_alert_title">不支持微信报名，请使用支付宝APP扫描</div>
        <img src="img/g1xs1559182892.png" class="ermimg">
       
    </div> -->

    <!--其它浏览器打开-->
    <!-- <div v-if="isalipay&&isalipay==3" class="broswer_alert_box">
        <img src="img/icon_unsupport.png" class="broswer_alert_img">
        <div class="broswer_alert_title">不支持该浏览器报名,请使用支付宝APP扫描</div>
        <img src="img/g1xs1559182892.png" class="ermimg">
       
    </div> -->


</div>
<script src="js/jquery.min.js"></script>
<script src="js/vue.js"></script>
<script src="js/config.js"></script>
<script src="js/mint-ui.js"></script>
<script>
    new Vue({
        el: '#warp',
        data: {
            user:'',
            isalipay:"",
            project_hash:'',
            redirect_uri:'',
            scope:''

        },
        mounted: function () {
            // 获取code
            if(this.getQueryString("app_id")){
                this.project_hash=this.getQueryString("app_id");
                this.scope=this.getQueryString("scope");
                this.redirect_uri=this.getQueryString("auth_code");
                alert(this.redirect_uri)
                
            }
           else{
                window.location.href="https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id=2018100861620537&scope=auth_userinfo,auth_user&redirect_uri=http://m.ykt.100eks.cn/index.html"
           }
            //this.submit_token()
            // const that=this;
            // that.isalipay = that.getbrowertype();
            
            // that.isalipay=2;
            // if(that.isalipay==2){
            //     window.location.href="login.html";
            // }else{

            // }

        },
        methods:{
            getbrowertype: function () {
                var ua = navigator.userAgent.toLowerCase();
                if (ua.match(/MicroMessenger/i) == "micromessenger") {
                    return 1;
                }else  if (ua.match(/Alipay/i) == "alipay") {
                    return 2;
                } else {
                    return 3;
                }
            },
            // auth_code换取access_token与user_id
            submit_token: function (type) {
                var that = this;
                var request = {
                    "mid": that.redirect_uri,
                }
                var requesturl = root + fdsmemberupdateinfo;
                that.loadAnimation();
                setTimeout(function () {
                    $.ajax({
                        type: "post",
                        url: requesturl,
                        beforeSend: function (XMLHttpRequest) {
                            XMLHttpRequest.setRequestHeader("token", that.user.token);
                        },
                        data: {
                            request: JSON.stringify(request)
                        },
                        dataType: "json",
                        success: function (data) {
                            that.closeAnimation();
                            if (data.code == 0) {
                                window.location.href="cards.html";
                            }else {
                                that.errorTips(data.msg);
                            }
                        },
                        error: function () {

                            that.closeAnimation();
                            that.errorTips('网络错误,请重试！');
                        }
                    });

                }, 1000)
            },

            /*获取参数*/
            getQueryString: function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            },

            confirm:function () {
                window.history.back();
            },

            errorTips: function (msg) {
                this.$toast(msg)
            },
            loadAnimation: function () {
                this.$indicator.open({
                    spinnerType: 'fading-circle'
                });
            },
            closeAnimation: function () {
                this.$indicator.close();
            }
        }
    })
</script>

</body>
</html>