<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="content-type" content="text/html;charset=gbk">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <title></title>
    <link href="css/reset.css" rel="stylesheet">
    <link href="css/login.css" rel="stylesheet">
    <link href="css/iosSelect.css" rel="stylesheet">
    <link rel="stylesheet" href="css/element-ui.css">

    <script type="text/javascript">
        var w = document.documentElement.clientWidth >= 1024 ? 1024 : document.documentElement.clientWidth;
        document.documentElement.style.fontSize = w / 750 * 100 + 'px';
    </script>

    <style>
        body{
            /* background-color: #d1effd; */
        }
        input:-webkit-autofill,
        textarea:-webkit-autofill,
        select:-webkit-autofill {
            -webkit-box-shadow: 0 0 0 1000px white inset;
        }

        [v-cloak] {
            display: none;
        }
    </style>
</head>
<body>
<div class="warp" id="warp" v-cloak>

    <div class="school_box">
        <img  class="school_img" src="./img/first_3.png">
        <div class="title">绑定一卡通账号</div>
    </div>
    <div class="logos">
        <img  class="logo_img" src="./img/first_1.png">
        <div class="logotitle">绑定一卡通</div>
    </div>
    <div class="main">

        <div class="box">
            <span> <img  class="box_img" src="./img/first_5.png"></span>
            <input type="text" value="" placeholder="请输入工号/学号" v-model="student_id">
        </div>
        <div class="box">
            <span><img  class="box_img" src="./img/first_4.png"></span>
            <input type="text" value="" placeholder="请输入真实姓名" v-model="names">
        </div>

        <div class="box">
            <span><img  class="box_img" src="./img/first_2.png"></span>
           <input type="text" value="" placeholder="请输入一卡通密码" v-model="passwprd">

        </div>
        <div class="btn" @click="login">绑定</div>
        <div class="box" style=" border-bottom: 1px solid transparent;">
            <div class="btnhelp" > 
                点击绑定表明你已同意
                <a @click="go2help" style="color: #36a7fa;">《一卡通开放平台协议》</a>
            </div>
        </div>

    </div>
    <!-- <a  v-if="isOriginHeight==true" href="http://m.fangao.100eks.com" target="_blank"> -->
        <div class="bottom_boxs" style="font-size: 0.26rem;">技术服务电话：19930381437，19930383437</div>
        <div class="bottom_box" style="font-size: 0.26rem; color: gray;">
            本系统由
            <a href="http://m.fangao.100eks.com" style="color: #36a7fa;">凡高云校园</a>
             提供技术支持
        </div>
    <!-- </a> -->

</div>
<script src="js/jquery.min.js"></script>
<script src="js/vue.js"></script>
<script src="js/jquery-md5.js"></script>
<script src="js/config.js"></script>
<script src="js/iosSelect.js"></script>
<script src="js/element-ui.js"></script>
<!-- 引入样式 -->
<link rel="stylesheet" href="https://unpkg.com/mint-ui/lib/style.css">
<!-- 引入组件库 -->
<script src="https://unpkg.com/mint-ui/lib/index.js"></script>

<script>
    new Vue({
        el: '#warp',
        data: {
            student_id: '',
            passwprd: '',
            names:'',
            
            originHeight:'',
            screenHeight:'',
            isOriginHeight:true,

        },

        created: function () {
            // var project_hash=   this.getQueryString("project_hash");
            // if(project_hash){
            //     sessionStorage.project_hash=project_hash;
            //     this.project_hash=sessionStorage.project_hash;
            // }else  if(sessionStorage.project_hash){
            //     this.project_hash=sessionStorage.project_hash;
            // }
            // if(!this.school){
            //     this.getSchoolInfo();
            // }
        },

        mounted: function () {
            const that=this;
            that.originHeight= document.documentElement.clientHeight;
            window.onresize =function () {
                that.screenHeight = document.documentElement.clientHeight;
                if(that.originHeight - that.screenHeight>60) {    //这里以防万一改了下判断形式，当屏幕高度减少了60px以上时才隐藏footer
                    that.isOriginHeight = false;
                }else{
                    that.isOriginHeight = true;
                }
            }

        },
        methods: {
            go2help(){
                window.location.href = 'help.html';
            },
            /*获取参数*/
            getQueryString: function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            },

            /**
             * 获取学校信息
             */
            getSchoolInfo:function () {
                const that=this;
                var request={"project_hash":this.project_hash};
                $.ajax({
                    type: "post",
                    url: root+fdsmemberschoolinfo,
                    beforeSend:function(){

                    },
                    data: {
                        request:JSON.stringify(request)
                    },
                    dataType: "json",
                    success: function(data){
                        if(data.code == 0){
                            that.school=data.data;
                        }
                    },
                    error: function() {
                        that.loading = false;
                        that.closeAnimation();
                        that.errorTips("网络错误,请重试！");
                    }
                });
            },

            /**
             * 登录
             */
            login: function () {
                // window.location.href = 'mainsucess.html';
                // return
                var that = this;
                if (!this.student_id) {
                    this.errorTips('请填写工号/学号');
                    return false;
                }
                if (!this.names) {
                    this.errorTips('请填写真实姓名');
                    return false;
                }
                if (!this.passwprd) {
                    this.errorTips('请填写密码');
                    return false;
                }
                var request = {
                    stu_sn: this.student_id, 
                    school_id: this.names,
                    image_code:this.passwprd,
                    
                };
				// sessionStorage.school_id = this.school_id;
                that.loadAnimation();
                setTimeout(function () {
                    $.ajax({
                        type: "post",
                        url: root + fdsmemberexecutelogin,
                        beforeSend: function () {
                        },
                        data: {
                            request: JSON.stringify(request)
                        },
                        dataType: "json",
                        success: function (data) {
                            that.loading = false;
                            that.closeAnimation();
                            if (data.code == 0) {
                                var data = JSON.stringify(data.data);
                                setTimeout(function () {
                                    window.location.href = 'cards.html';
                                    // window.location.href = 'mainsucess.html';
                                   
                                }, 500)
                            } else {
                                that.errorTips(data.msg);
                            }
                        },
                        error: function () {
                            that.loading = false;
                            that.closeAnimation();
                            that.errorTips('网络错误,请重试！');
                        }
                    });
                }, 1000)
            },
            /**
             * 校验身份证
             */
            id_cardcheck:function (val) {
                var  regular1=/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;
                var  regular2=/^[1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2}[0-9Xx]$/;
                if (!regular1.test(val)&&!regular2.test(val)) {
                    return false;
                }else{
                    return true;
                }
            },
            isPoneAvailable: function (val) {
                var myreg = /^[1][0-9]{10}$/;
                if (!myreg.test(val)) {
                    return false;
                } else {
                    return true;
                }
            },
            errorTips: function (msg) {
                this.$toast(msg)
            },
            loadAnimation: function () {
                this.$indicator.open({
                    spinnerType: 'fading-circle'
                });
            },
            closeAnimation: function () {
                this.$indicator.close();
            }
        }
    })
</script>
</body>
</html>