<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="content-type" content="text/html;charset=gbk">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
    <title>一卡通列表</title>
    <link href="css/reset.css" rel="stylesheet">
    <link href="css/submitfillinfo.css" rel="stylesheet">
    <link href="css/iosSelect.css" rel="stylesheet">

    <script type="text/javascript">
        var w = document.documentElement.clientWidth >= 1024 ? 1024 : document.documentElement.clientWidth;
        document.documentElement.style.fontSize = w / 750 * 100 + 'px';
    </script>
    <style>
        body {
            background-color: #f6f6f6;
        }

        input:-webkit-autofill,
        textarea:-webkit-autofill,
        select:-webkit-autofill {
            -webkit-box-shadow: 0 0 0 1000px white inset;
        }

        [v-cloak] {
            display: none;
        }
    </style>
</head>
<body style="background: #f9f9f9">
<div class="warp" id="warp" v-cloak style="position: relative;height: 100%;width: 100%;">
    <div class="cardheaders">
        <span class="span_1">
            已绑定卡
        </span>
        <span class="span_2" @click="bindcard">
            <img src="./img/bangding.png" alt="">
            绑定一卡通
        </span>
    </div>
    <div class="content_boxcar">
            <a href='mainsucess.html'>
        <div class="cell-box-card" v-for="item in cardlists">
            <div class="topimg_card" @click="tocarddetail(item.stu_sn,item.child_mid,item.stu_name,item.school_name)">
                <img src="./img/card.png" class="sdf" alt="">
                <div class="hea">
                    <span>
                        {{item.school_name}}
                    </span>
                    <span class="spants">{{item.stu_name}}</span>
                </div>
                <div class="center">
                    <span style="font-size: 0.6rem;">{{item.stu_sn}}</span>
                </div>
                <div class="footers_card">
                    <p>校园一卡通</p>
                </div>
            </div>
        </div>
    </a>
    </div>
</div>
<script src="js/config.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/vue.js"></script>
<script src="js/jquery-md5.js"></script>
<script src="js/iosSelect.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
<script src="js/mint-ui.js"></script>
<!-- 引入样式 -->
<link rel="stylesheet" href="https://unpkg.com/mint-ui/lib/style.css">
<!-- 引入组件库 -->
<script src="https://unpkg.com/mint-ui/lib/index.js"></script>
<script>
    history.pushState({}, ""); 
    window.onpopstate = function(event) {
        //这里可以监听到浏览器的返回事件，并做你想做的事情，
        location.href = "cards.html";
    };
</script>
<script>
    new Vue({
        el: '#warp',
        data: {
            user: '',
            originHeight: '',
            screenHeight: '',
            isOriginHeight: true,
            cardlists: [],//卡片列表
        },
        created: function () {
        },
        mounted: function () {
            const that = this;
            // that.originHeight = document.documentElement.clientHeight;
            // window.onresize = function () {
            //     that.screenHeight = document.documentElement.clientHeight;
            //     if (that.originHeight - that.screenHeight > 60) { //这里以防万一改了下判断形式，当屏幕高度减少了60px以上时才隐藏footer
            //         that.isOriginHeight = false;
            //     } else {
            //         that.isOriginHeight = true;
            //     }
            // }
            // that.initEventListener();
            // 卡片列表
            that.card_lists()
            
        },
        methods: {
            // 绑定一卡通
            bindcard() {
                window.location.href = 'login.html';
            },
            initEventListener: function () {
                document.body.addEventListener('focusout', function () {
                    window.scrollTo(0, 0);
                })
                document.addEventListener('touchstart', touch, false);
                document.addEventListener('touchmove', touch, false);
                document.addEventListener('touchend', touch, false);

                function touch(event) {
                    var event = event || window.event;
                    var oInp = document.getElementById("inp");
                    switch (event.type) {
                        case "touchstart":
                            break;
                        case "touchend":
                            window.scrollTo(0, 0);
                            break;
                        case "touchmove":
                            //                        event.preventDefault();

                            break;
                    }

                }
            },

            /**
             * 卡片列表
             */
            card_lists: function (type) {
                var that = this;
                var request = {
                    "mid": sessionStorage.mid,
                }
                // that.loadAnimation();
                $.ajax({
                    type: "post",
                    url: root + "gzxs.member.bind.cards",
                    beforeSend: function (XMLHttpRequest) {
                        XMLHttpRequest.setRequestHeader("token", sessionStorage.token);
                    },
                    data: {
                        request: JSON.stringify(request)
                    },
                    dataType: "json",
                    success: function (data) {
                        // that.closeAnimation();
                        if (data.code == 0) {
                            that.cardlists = data.data
                            if (that.cardlists.length == 0) {
                                window.location.href = 'login.html';
                            }
                        } else {
                            that.errorTips(data.msg);
                        }
                    },
                    error: function () {
                        // that.closeAnimation();
                        that.errorTips('网络错误,请重试！');
                    }
                });
                

            },
            /**
             * 点击卡片进入详情
             */
            tocarddetail: function (snumber, childid, stuname,school_name) {
                let that=this
                // window.location.href = 'mainsucess.html';
                sessionStorage.snumber = snumber
                sessionStorage.childid = childid
                sessionStorage.stu_name = stuname
                sessionStorage.school_name = school_name
                
            },
            errorTips: function (msg) {
                this.$toast(msg)
            },
            loadAnimation: function () {
                this.$indicator.open({
                    spinnerType: 'fading-circle'
                });
            },
            closeAnimation: function () {
                this.$indicator.close();
            }
        }
    })
</script>
</body>
</html>
