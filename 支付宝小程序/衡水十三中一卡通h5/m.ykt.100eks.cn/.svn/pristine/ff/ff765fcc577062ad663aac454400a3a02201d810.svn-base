<!DOCTYPE html>
<html lang="en" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="content-type" content="text/html;charset=gbk">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
    <title>欢迎使用</title>
    <link href="css/reset.css" rel="stylesheet">
    <link href="css/submitfillinfo.css" rel="stylesheet">
    <link href="css/iosSelect.css" rel="stylesheet">

    <script type="text/javascript">
        var w = document.documentElement.clientWidth >= 1024 ? 1024 : document.documentElement.clientWidth;
        document.documentElement.style.fontSize = w / 750 * 100 + 'px';
    </script>
    <style>
        body {
            background-color: #f6f6f6;
        }

        input:-webkit-autofill,
        textarea:-webkit-autofill,
        select:-webkit-autofill {
            -webkit-box-shadow: 0 0 0 1000px white inset;
        }

        [v-cloak] {
            display: none;
        }
    </style>
</head>
<body style="background: #f9f9f9">
<div class="warp" id="warp" v-cloak style="position: relative;height: 100%;width: 100%;">
    <div class="content_box">
        <div class="cardheaders">
            <span class="span_1">
                已绑定卡
            </span>
            <span class="span_2" @click="bindcard">
                <img src="./img/bangding.png" alt="">
                绑定一卡通
            </span>
        </div>
        <div class="cell-box-card">
            <div class="topimg_card" @click="tocarddetail"> 
                <img src="./img/card.png" class="sdf" alt="">
                <div class="hea">
                    <span>
                        <img src="./img/first_1.png" alt="">
                        衡水第十三中学
                    </span>
                   
                </div>
                <div class="center">
                    <span style="font-size: 0.6rem">2019746512050</span>
                </div>
                <div class="footers_card">
                   <p>校园一卡通</p>
                </div>
            </div>
        </div>
    </div>
  
</div>
<script src="js/jquery.min.js"></script>
<script src="js/vue.js"></script>
<script src="js/jquery-md5.js"></script>
<script src="js/iosSelect.js"></script>
<link rel="stylesheet" href="css/mint-ui.css">
<script src="https://www.promisejs.org/polyfills/promise-6.1.0.js"></script>
<script src="http://gosspublic.alicdn.com/aliyun-oss-sdk-4.3.0.min.js"></script>

<script src="js/config.js"></script>
<!-- 引入样式 -->
<link rel="stylesheet" href="https://unpkg.com/mint-ui/lib/style.css">
<!-- 引入组件库 -->
<script src="https://unpkg.com/mint-ui/lib/index.js"></script>
<script src="js/mint-ui.js"></script>
<!--<script language="javascript">-->
<!--//防止页面后退-->
<!--history.pushState(null, null, document.URL);-->
<!--window.addEventListener('popstate', function () {-->
<!--history.pushState(null, null, document.URL);-->
<!--});-->
<!--</script>-->

<script>
    new Vue({
        el: '#warp',
        data: {
            totip:false,//弹框
            jiebangpass:'',//解绑密码
            user:'',
            originHeight: '',
            screenHeight: '',
            isOriginHeight: true,
            cardlists:[],//卡片列表

        },
        created: function () {
			// this.stu_name= this.getQueryString('stu_name');
        },
        mounted: function () {
            const that = this;
            // if (!sessionStorage.user) {
            //     window.location.href = 'login.html'
            // } else {
            //     this.user = JSON.parse(sessionStorage.user);
            //     $("#warp").css({
            //         "display": "block"
            //     });
            // }
            that.originHeight = document.documentElement.clientHeight;

            window.onresize = function () {
                that.screenHeight = document.documentElement.clientHeight;
                if (that.originHeight - that.screenHeight > 60) { //这里以防万一改了下判断形式，当屏幕高度减少了60px以上时才隐藏footer
                    that.isOriginHeight = false;
                } else {
                    that.isOriginHeight = true;
                }
            }
            that.initEventListener();
            that.card_lists()
        },


        methods: {
            // 绑定一卡通
            bindcard(){
                window.location.href = 'login.html';
            },
            initEventListener: function () {
                document.body.addEventListener('focusout', function () {
                    window.scrollTo(0, 0);
                })
                document.addEventListener('touchstart', touch, false);
                document.addEventListener('touchmove', touch, false);
                document.addEventListener('touchend', touch, false);
                function touch(event) {
                    var event = event || window.event;

                    var oInp = document.getElementById("inp");

                    switch (event.type) {
                        case "touchstart":

                            break;
                        case "touchend":
                            window.scrollTo(0, 0);
                            break;
                        case "touchmove":
                            //                        event.preventDefault();

                            break;
                    }

                }
            },
           
            /*获取参数*/
            getQueryString: function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            },

            isIos: function () {
                var u = navigator.userAgent, app = navigator.appVersion;
                var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //android终端或者uc浏览器
                var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
                if (isAndroid) {
                    return false;
                }
                if (isiOS) {
                    return true;
                }
            },
            /**
             * 卡片列表
             */
             card_lists: function (type) {
                var that = this;
                var request = {
                    "mid": sessionStorage.mid,
                }
                var requesturl = root + yktcards;
                that.loadAnimation();
                setTimeout(function () {
                    $.ajax({
                        type: "post",
                        url: requesturl,
                        beforeSend: function (XMLHttpRequest) {
                            XMLHttpRequest.setRequestHeader("token", sessionStorage.token);
                        },
                        data: {
                            request: JSON.stringify(request)
                        },
                        dataType: "json",
                        success: function (data) {
                           that.closeAnimation();
                            if (data.code == 0) {
                               that.cardlists=data.data
                            }else {
                                that.errorTips(data.msg);
                            }
                        },
                        error: function () {
                            that.closeAnimation();
                            that.errorTips('网络错误,请重试！');
                        }
                    });

                }, 1000)
            },
            /**
             * 点击卡片进入详情
             */
             tocarddetail: function (type) {
                var that = this;
                var request = {
                    "mid": that.user.stu_id,
                }
                var requesturl = root + yktcards;
                that.loadAnimation();
                setTimeout(function () {
                    $.ajax({
                        type: "post",
                        url: requesturl,
                        beforeSend: function (XMLHttpRequest) {
                            // XMLHttpRequest.setRequestHeader("token", that.user.token);
                        },
                        data: {
                            request: JSON.stringify(request)
                        },
                        dataType: "json",
                        success: function (data) {
                           that.closeAnimation();
                            if (data.code == 0) {
                                window.location.href = 'mainsucess.html';
                            }else {
                                that.errorTips(data.msg);
                            }
                        },
                        error: function () {
                            that.closeAnimation();
                            that.errorTips('网络错误,请重试！');
                        }
                    });

                }, 1000)
            },

            errorTips: function (msg) {
                // debugger
                this.$toast(msg)
            },
            loadAnimation: function () {
                this.$indicator.open({
                    spinnerType: 'fading-circle'
                });
            },
            closeAnimation: function () {
                this.$indicator.close();
            }
        }
    })
</script>


</body>
</html>
